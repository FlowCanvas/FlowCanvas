-- 테이블 삭제
DROP TABLE PROJECTS CASCADE CONSTRAINTS PURGE;
DROP TABLE USERS CASCADE CONSTRAINTS PURGE;
DROP TABLE KANBAN_COLUMNS CASCADE CONSTRAINTS PURGE;
DROP TABLE KANBAN_CARDS CASCADE CONSTRAINTS PURGE;
DROP TABLE FEEDBACKS CASCADE CONSTRAINTS PURGE;
DROP TABLE PROJECT_JOIN CASCADE CONSTRAINTS PURGE;

-- PROJECTS 테이블 생성
CREATE TABLE PROJECTS (
    PROJECT_ID NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    USER_ID NUMBER NOT NULL,
    PROJECT_NAME VARCHAR2(20) NOT NULL,
    PROJECT_JOIN_CODE VARCHAR2(50) NOT NULL,
    CREATED_AT TIMESTAMP NOT NULL
);

COMMENT ON COLUMN PROJECTS.PROJECT_ID IS '프로젝트 아이디';
COMMENT ON COLUMN PROJECTS.USER_ID IS '프로젝트장 아이디';
COMMENT ON COLUMN PROJECTS.PROJECT_NAME IS '프로젝트 명';
COMMENT ON COLUMN PROJECTS.PROJECT_JOIN_CODE IS '프로젝트 참여 코드';
COMMENT ON COLUMN PROJECTS.CREATED_AT IS '생성일시';

-- USERS 테이블 생성
CREATE TABLE USERS (
    USER_ID NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    EMAIL VARCHAR2(50) NOT NULL,
    NICK_NAME VARCHAR2(20) NOT NULL,
    PASSWORD VARCHAR2(1000) NOT NULL,
    CREATED_AT TIMESTAMP NOT NULL
);

COMMENT ON COLUMN USERS.USER_ID IS '사용자 아이디';
COMMENT ON COLUMN USERS.EMAIL IS '이메일';
COMMENT ON COLUMN USERS.NICK_NAME IS '닉네임';
COMMENT ON COLUMN USERS.PASSWORD IS '비밀번호';
COMMENT ON COLUMN USERS.CREATED_AT IS '생성일시';

-- KANBAN_COLUMNS 테이블 생성
CREATE TABLE KANBAN_COLUMNS (
    KANBAN_COLUMN_ID NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    PROJECT_ID NUMBER NOT NULL REFERENCES PROJECTS(PROJECT_ID),
    KANBAN_COLUMN_NAME VARCHAR2(50) NOT NULL,
    USE_FLAG CHAR(1) DEFAULT 'Y' NOT NULL,
    CREATED_AT TIMESTAMP NOT NULL
);

COMMENT ON COLUMN KANBAN_COLUMNS.KANBAN_COLUMN_ID IS '칸반 컬럼 아이디';
COMMENT ON COLUMN KANBAN_COLUMNS.PROJECT_ID IS '프로젝트 아이디';
COMMENT ON COLUMN KANBAN_COLUMNS.KANBAN_COLUMN_NAME IS '칸반 컬럼명';
COMMENT ON COLUMN KANBAN_COLUMNS.USE_FLAG IS '사용여부 (Y/N)';
COMMENT ON COLUMN KANBAN_COLUMNS.CREATED_AT IS '생성일시';

-- KANBAN_CARDS 테이블 생성
CREATE TABLE KANBAN_CARDS (
   KANBAN_CARD_ID NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
   KANBAN_COLUMN_ID NUMBER NOT NULL REFERENCES KANBAN_COLUMNS(KANBAN_COLUMN_ID),
   USER_ID NUMBER NOT NULL REFERENCES USERS(USER_ID),
   KANBAN_CARD_NAME NVARCHAR2(20) NOT NULL,
   CARD_SEQ NUMBER NOT NULL,
   PRIORITY NUMBER,
   TASK_SIZE NUMBER,
   CONTENT NVARCHAR2(2000),
   CREATED_AT TIMESTAMP NOT NULL,
   UPDATED_AT TIMESTAMP NOT NULL
);

COMMENT ON COLUMN KANBAN_CARDS.KANBAN_CARD_ID IS '칸반 카드 아이디';
COMMENT ON COLUMN KANBAN_CARDS.KANBAN_COLUMN_ID IS '칸반 컬럼 아이디';
COMMENT ON COLUMN KANBAN_CARDS.USER_ID IS '작성자 아이디';
COMMENT ON COLUMN KANBAN_CARD_NAME IS '칸반 카드 이름';
COMMENT ON COLUMN KANBAN_CARDS.CARD_SEQ IS '카드 순서';
COMMENT ON COLUMN KANBAN_CARDS.PRIORITY IS '우선순위 (0: 낮음, 1: 중간, 2: 높음, 3: 긴급)';
COMMENT ON COLUMN KANBAN_CARDS.TASK_SIZE IS '작업크기 (0: 작음, 1: 중간, 2: 높음, 3: 매우 높음)';
COMMENT ON COLUMN KANBAN_CARDS.CONTENT IS '내용';
COMMENT ON COLUMN KANBAN_CARDS.CREATED_AT IS '생성일시';
COMMENT ON COLUMN KANBAN_CARDS.UPDATED_AT IS '수정일시';

-- FEEDBACKS 테이블 생성
CREATE TABLE FEEDBACKS (
   FEEDBACK_ID NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
   KANBAN_CARD_ID NUMBER NOT NULL REFERENCES KANBAN_CARDS(KANBAN_CARD_ID),
   USER_ID NUMBER NOT NULL REFERENCES USERS(USER_ID),
   CONTENT VARCHAR2(1000) NOT NULL,
   CREATED_AT TIMESTAMP NOT NULL,
   UPDATED_AT TIMESTAMP NOT NULL
);

COMMENT ON COLUMN FEEDBACKS.FEEDBACK_ID IS '피드백 아이디';
COMMENT ON COLUMN FEEDBACKS.KANBAN_CARD_ID IS '칸반보드 카드 아이디';
COMMENT ON COLUMN FEEDBACKS.USER_ID IS '작성자 아이디';
COMMENT ON COLUMN FEEDBACKS.CONTENT IS '내용';
COMMENT ON COLUMN FEEDBACKS.CREATED_AT IS '생성일시';
COMMENT ON COLUMN FEEDBACKS.UPDATED_AT IS '수정일시';

-- PROJECT_JOIN 테이블 생성
CREATE TABLE PROJECT_JOIN (
    PROJECT_JOIN_ID NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    PROJECT_ID NUMBER NOT NULL REFERENCES PROJECTS(PROJECT_ID),
    USER_ID NUMBER NOT NULL REFERENCES USERS(USER_ID),
    JOINED_AT TIMESTAMP NOT NULL
);

COMMENT ON COLUMN PROJECT_JOIN.PROJECT_JOIN_ID IS '프로젝트 참여 아이디';
COMMENT ON COLUMN PROJECT_JOIN.PROJECT_ID IS '프로젝트 아이디';
COMMENT ON COLUMN PROJECT_JOIN.USER_ID IS '사용자 아이디';
COMMENT ON COLUMN PROJECT_JOIN.JOINED_AT IS '참여일시';